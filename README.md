# Wordpress Bedrock Boilerplate
Document Link: [Flexible Template Builder Manual](https://docs.google.com/document/d/1z1VhOr5MqNFbS1OAwEdVPeYp9kSAhK0Vb9PClrs4vCU)

## Development Dependencies
1. Lando: [Install using instructions for your OS here](https://docs.devwithlando.io/).  (Lando version at least v3.0.0-rc.8).
2. Docker Community Edition (Docker version 19.03.2, build 6a30dfc).
3. Node JS (recommended v10.16.3).
4. npm (recommended v6.9.0).
5. gulp - Just execute `npm install -g gulp`.
6. Ruby (>=2.4) `sudo apt-get install ruby-full`
7. scss-lint `sudo gem install scss-lint`


## Installation
1. Clone this repository with a project name:
    - SSH: `git clone git@gitlab.com:offshorly-cms/wordpress-bedrock-boilerplate.git project-name`
    - HTTPS: `git clone https://gitlab.com/offshorly-cms/wordpress-bedrock-boilerplate.git project-name`
2. Edit value of `name` in `lando.yml` into your project name.
3. Create a `.env` file based on `.env.example`.
    - Set `DB_NAME`, `DB_USER`, `DB_PASSWORD` to `wordpress`.
    - Uncomment `DB_HOST` then change value to `database`.
4. Run `lando start`.
5. Run `lando composer update`.
6. Go to your local site URL generated by lando. (e.g `https://wordpress-bedrock-boilerplate.lndo.site`) and install Wordpress.
7. Navigate to `web/app/themes/{theme-folder}` then execute the following commands:
    - `npm install` to install dependencies.
    - `gulp build` to build assets of the project.
8. **If a staging site is not existing, stop at Step 7.** Login to Wordpress dashboard. Then enable WP Sync DB and WP Sync DB Media Files
9. Then go to Tools > Migrate DB then configure pull settings to pull DB from staging site [http://wp-boilerplate.preview.direct/](http://wp-boilerplate.preview.direct/)

## Additional Notes
- **TIP:** to avoid repeatedly executing `gulp build` to build assets of the project while you're working on assets execute a `gulp watch`. **NOTE:** This will work only if you're working on `scss` and `js` file changes. When adding image assets you have to execute `gulp build` again.
- Theme folder for parent is `template-builder`
- Theme folder for child is `timber-theme`

## Parent Theme Development
### File Structure and Rules
1. Make sure you only change parent folder `web/app/themes/template-builder`
2. Create a twig file for your block inside partial folder `web/app/themes/template-builder/partial` **NOTE: Make the filename same with the block name but use hyphen instead . For example your block name is `text_block`, your filename should be `text-block.twig`**
3. Always wrap your elements inside a div with class names “uk-width-1-1” and a unique class that identifies the block **(preferably same with your filename)**
```
<div class="uk-width-1-1 text-block">
    {# Your code #}
</div>
```
4. Create an scss file inside partial folder of assets `web/app/themes/template-builder/assets/styles/partial` **NOTE: Make the filename same with the twig file filename, just add underscore before e.g(`_text.block.scss`)**
5. Always wrap styles inside the unique class. 
```
.text-block {
    // your styles
}
```
6. Import your twig file to page.twig. **NOTE: Add a comment that identifies your block for easy searching**.
7. Import your style file to app.scss.

### Coding Rules
1. Avoid unnecessary inline style.
2. Avoid duplicate html element id.
3. Use scss variables for styles that are reusable such as colors.
4. Always remove unnecessary assets like unused images/logos/fonts.
5. If using javascript/jQuery, also use variables for things that are reusable such as functions and data.
6. As much as possible use `const` and `let` when declaring variables on javascript/jQuery.
7. Always make the indentation proper.
8. Avoid unnecessary spaces.
9. When adding functions in `functions.php` make sure to leave a comment there and describe what the added function is doing.
10. SCSS Lint warnings should be fixed before pushing changes. For references use this document: Default rules of sass-lint. Please refer to this [SCSS Lint Rules](https://github.com/sds/scss-lint/blob/master/lib/scss_lint/linter/README.md)

### Process of pushing changes to Repo
To maintain a good git history, we have to use the process of pull requests. Usually there are  2 scenarios here.
1. **No existing feature branch**
    - Make sure you are in the `develop` branch
    - Execute a `git stash` command to stash your changes
    - Execute a `git pull` command to pull latest change in develop branch
    - Create and checkout to a new branch by executing `git checkout -b <branchName>` **NOTE: To make our branch names uniform name your branch like this “feature/create-text-block”**
    - You should be on your newly created branch now based on updated develop code. Now execute `git stash apply` command to insert your changes.
    - If there are conflicts make sure to fix it first. Usually there will be conflicts in `page.twig` and `app.scss` because everyone will be editing that when importing their codes. Fix this by making sure both conflicted import code and your import code is there.
    - When all conflicts are solved add, commit, and push your changes.
    - Create a pull request that requests to merge your branch to `develop` in Gitlab repo **NOTE: Please always tick the checkboxes “Delete branch after merge” and “Squash commits”.**
    - Just to double check, Gitlab detects code conflicts, so make sure Gitlab says it has no conflict with `develop` branch
2. **You are currently working on an existing feature branch**
    - Add, commit, and push your changes to your feature branch.
    - Checkout to develop branch by executing `git checkout develop`
    - Execute a `git pull` command to pull latest change in develop branch
    - Then go back to your feature branch `git checkout <branchName>`
    - Execute a `git rebase develop` command to update your feature branch with the latest develop branch code.
    - If there are conflicts make sure to fix it first. Usually there will be conflicts in `page.twig` and `app.scss` because everyone will be editing that when importing their codes. Fix this by making sure both conflicted import code and your import code is there.
    - When all conflicts are solved, `git add` all the files with conflicts. **NOTE: You can see the files with conflict by executing `git status`.**
    - When all files with conflicts are added, execute a `git rebase --continue` command.
    - After this execute a `git push -f` command to update your remote feature branch.
    - Create a pull request that requests to merge your branch to `develop` in Gitlab repo **NOTE: Please always tick the checkboxes “Delete branch after merge” and “Squash commits”.**
    - Just to double check, Gitlab detects code conflicts, so make sure Gitlab says it has no conflict with `develop` branch.

### DB Changes
1. After creating your new block replicate your changes to staging site [http://wp-boilerplate.preview.direct/](http://wp-boilerplate.preview.direct/).
2. Notify the developers when doing your changes in staging to prevent overwriting of work.

## Child Theme Development (customizing for a specific website)
1. Copy the template folder of parent theme to the child theme **NOTE: When developing a customized website you must not edit the parent theme. All changes must be only on child theme.**
2. Start customizing the blocks and styles in template.
3. If you want to override a file from parent theme, create a file with the exact path and filename in the child theme.
4. When customizing the style of a block, copy the scss file from parent theme and paste it on the child theme in the same path. For example you want to customize the style for `text-block.scss` copy the `text-block.scss` of parent theme inside /assets/styles/partial/ of child theme.